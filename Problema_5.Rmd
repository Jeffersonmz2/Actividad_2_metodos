---
title: "Problema 5"
author: "Ricardo_Vargas_M"
date: "2025-09-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Problema 5: Análisis de potencia, tamaño del efecto y errores tipo I y II en una prueba de hipótesis
Caso: Se asume que la presión arterial en la población general sigue una distribución normal con media 120 mmHg y desviación estándar 15 mmHg. Un laboratorio desea evaluar si la media de presión arterial en un grupo de pacientes con cierta enfermedad difiere significativamente de 120 mmHg, mediante una prueba t para una muestra, asumiendo varianza poblacional desconocida.

Objetivo del caso: Determinar de manera informada un tamaño de muestra y un nivel de significancia adecuados para realizar el estudio.

Para lograr este objetivo, analiza la relación entre la potencia estadística, el tamaño del efecto y el tamaño muestral.

Fija inicialmente el nivel de significancia en α=0.1

Evalúa la potencia estadística para diferentes tamaños muestrales n=
 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 200, 300, 400, 500, 600, 700, 800, 900 y 1,000.

Considera tres tamaños del efecto: d=0.2
 (pequeño), d=0.5
 (mediano), d=0.8
 (grande).

Visualiza los resultados:

Eje X
: tamaño muestral.

Eje Y
: potencia estadística.

Traza una curva para cada tamaño del efecto.

Utiliza las funciones power.t.test y ggplot2 en R para construir los gráficos.

Posteriormente, repite el análisis para α=0.05
 y α=0.01
 y compara los tres gráficos.

Preguntas orientadoras para el análisis:

¿Qué tamaño de muestra se requiere para alcanzar una potencia del 80% al detectar un efecto grande(d=0.8
)?

¿Cuántas observaciones se necesitan para detectar un efecto mediano (d=0.5
) con una potencia adecuada?

Para un efecto grande, ¿qué sucede al aumentar el tamaño de muestra más allá de 300 observaciones? ¿Es eficiente?

Explica cómo influye el tamaño del efecto sobre la potencia estadística.

¿Cómo afecta el tamaño muestral a la potencia estadística?

¿En qué punto aumentar el tamaño muestral deja de proporcionar beneficios significativos en la potencia?

Con base en los gráficos obtenidos y tu análisis, propón un tamaño de muestra y un nivel de significancia apropiados para diseñar el estudio.

```{r}
# Parámetros del problema
mu0   <- 120      # valor nulo
sdref <- 15       # sd de referencia (para definir d)
ds    <- c(0.2, 0.5, 0.8)  # tamaños del efecto (pequeño, mediano, grande)

# Secuencia de tamaños muestrales
ns <- c(10,20,30,40,50,60,70,80,90,100,200,300,400,500,600,700,800,900,1000)

library(dplyr)
library(tidyr)
library(ggplot2)

# Función que calcula potencia para un alfa dado (dos colas)
potencia_por_alpha <- function(alpha){
  expand.grid(n = ns, d = ds) |>
    as_tibble() |>
    mutate(delta = d * sdref,                         # diferencia en la escala original (mmHg)
           power = mapply(function(n, delta)
                     power.t.test(n = n,
                                  delta = delta, sd = sdref,
                                  sig.level = alpha,
                                  type = "one.sample",
                                  alternative = "two.sided")$power,
                     n, delta),
           alpha = alpha)
}

# Crea tres data frames (alpha = 0.10, 0.05, 0.01) y los apila
df_pow <- bind_rows(
  potencia_por_alpha(0.10),
  potencia_por_alpha(0.05),
  potencia_por_alpha(0.01)
)

# Para graficar cada alfa por separado (tres gráficos)
p <- ggplot(df_pow, aes(x = n, y = power, color = factor(d), group = d)) +
  geom_line(linewidth = 1) +
  geom_hline(yintercept = .80, linetype = 2, linewidth = .7) +  # línea de 80%
  scale_color_manual(values = c("#1f77b4","#2ca02c","#d62728"),
                     name = "Tamaño del efecto (d)",
                     labels = c("0.2 (pequeño)", "0.5 (mediano)", "0.8 (grande)")) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1,.1)) +
  labs(x = "Tamaño muestral (n)",
       y = "Potencia",
       title = "Curvas de potencia (t de 1 muestra, dos colas)",
       subtitle = "σ ref = 15 mmHg; potencias por tamaño del efecto") +
  theme_bw(base_size = 12) +
  facet_wrap(~ alpha, labeller = label_bquote(alpha==.(alpha)))
p

```

```{r}

necesario_80 <- expand.grid(d = ds, alpha = c(0.10, 0.05, 0.01)) |>
  as_tibble() |>
  mutate(delta = d * sdref,
         n_req = mapply(function(delta, alpha)
                  ceiling(power.t.test(power = .80,
                                       delta = delta, sd = sdref,
                                       sig.level = alpha,
                                       type="one.sample",
                                       alternative="two.sided")$n),
                  delta, alpha)) |>
  select(alpha, d, n_req)

necesario_80

```

